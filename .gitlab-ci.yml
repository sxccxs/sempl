image: 
  name: python:3.11-slim
  entrypoint: [ '/bin/bash', '-c', 'ln -snf /bin/bash /bin/sh && /bin/bash -c $0' ]

stages:
  - test

variables:
  POETRY_VERSION: "1.6.1"

before_script:
  - apt-get -y update && apt-get -y install curl
  - curl -sSL https://install.python-poetry.org | python3 - --version ${POETRY_VERSION}
  - export PATH=~/.local/bin:$PATH
  - poetry --version
  - poetry install

linting:
  stage: test
  allow_failure: true
  script:
    - poetry run pylint --rcfile=.pylintrc src tests

test:
  stage: test
  script:
    - mkdir -p ./reports
    - poetry run pytest tests/tg*.py -vvv --md-report --md-report-output=./reports/report.md 
  artifacts:
    paths:
      - ./reports
